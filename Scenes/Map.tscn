[gd_scene load_steps=11 format=2]

[ext_resource path="res://Scripts/Map.gd" type="Script" id=1]
[ext_resource path="res://Assets/Sprites/799px-Java_blank_map.svg.png" type="Texture" id=2]
[ext_resource path="res://Scenes/Kota/Kota.tscn" type="PackedScene" id=3]
[ext_resource path="res://Scripts/Kota/Custom_kota.gd" type="Script" id=4]
[ext_resource path="res://Scenes/RouteSelection.tscn" type="PackedScene" id=5]
[ext_resource path="res://Fonts/Arial_Rounded_MT.ttf" type="DynamicFontData" id=6]
[ext_resource path="res://Assets/Sprites/Desain Mobile/600x320.png" type="Texture" id=7]
[ext_resource path="res://Assets/Sprites/Desain Mobile/CariBis.png" type="Texture" id=8]

[sub_resource type="GDScript" id=1]
script/source = "extends \"res://Scripts/RouteSelection.gd\"

var selected_cities = []

func ready():
	$Button.hide()

func cities_data(data):
	print(data)
	selected_cities.append(data)
	_check_action_state()

func _check_action_state():
	if selected_cities.size() == 1:
		.change_state(state.TUJUAN)
	elif selected_cities.size() == 2:
		.change_state(state.CONFIRM)
		$Button.show()


func _on_Button_pressed():
	var source 		: String = selected_cities[0].nama
	var destination : String = selected_cities[1].nama
	DataManager.set_current_cities(source, destination)
	source = source.to_lower()
	destination = destination.to_lower()
	$HTTPRequest.request(\"http://127.0.0.1/caribis/api/rute?source=%s&destination=%s\" % [source, destination])
	


func _on_HTTPRequest_request_completed(result, response_code, headers, body):
	var json = JSON.parse(body.get_string_from_utf8())
	DataManager.set_current_route(json.result[0])
	get_tree().change_scene(\"res://Scenes/Bus/BusSelection.tscn\")
"

[sub_resource type="DynamicFont" id=2]
size = 28
font_data = ExtResource( 6 )

[node name="Map" type="Node2D"]
script = ExtResource( 1 )

[node name="TextureRect" type="TextureRect" parent="."]
visible = false
margin_right = 600.0
margin_bottom = 320.0
rect_scale = Vector2( 2.2, 2.2 )
texture = ExtResource( 7 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Jawa" type="Sprite" parent="."]
position = Vector2( 640, 295 )
texture = ExtResource( 2 )

[node name="Cities" type="Node2D" parent="."]
position = Vector2( 131, 95 )

[node name="Bandung" parent="Cities" instance=ExtResource( 3 )]
position = Vector2( 321.841, 166.281 )
script = ExtResource( 4 )
nama_kota = "Bandung"

[node name="Semarang" parent="Cities" instance=ExtResource( 3 )]
position = Vector2( 517.105, 182.316 )
script = ExtResource( 4 )
nama_kota = "Semarang"

[node name="Surabaya" parent="Cities" instance=ExtResource( 3 )]
position = Vector2( 722.895, 201.263 )
script = ExtResource( 4 )
nama_kota = "Surabaya"

[node name="Yogyakarta" parent="Cities" instance=ExtResource( 3 )]
position = Vector2( 547.158, 238.105 )
script = ExtResource( 4 )
nama_kota = "Yogyakarta"

[node name="Jakarta" parent="Cities" instance=ExtResource( 3 )]
position = Vector2( 252.421, 112.842 )
script = ExtResource( 4 )
nama_kota = "Jakarta"

[node name="Menu" parent="." instance=ExtResource( 5 )]
margin_top = 95.0
margin_bottom = 95.0
script = SubResource( 1 )

[node name="Button" type="Button" parent="Menu"]
margin_left = 583.0
margin_top = 350.0
margin_right = 696.0
margin_bottom = 390.0
custom_fonts/font = SubResource( 2 )
text = "Confirm"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="HTTPRequest" type="HTTPRequest" parent="Menu"]

[node name="CariBisTexture" type="TextureRect" parent="."]
margin_right = 1920.0
margin_bottom = 127.0
rect_scale = Vector2( 0.7, 0.7 )
texture = ExtResource( 8 )
__meta__ = {
"_edit_use_anchors_": false
}
[connection signal="pressed" from="Menu/Button" to="Menu" method="_on_Button_pressed"]
[connection signal="request_completed" from="Menu/HTTPRequest" to="Menu" method="_on_HTTPRequest_request_completed"]
